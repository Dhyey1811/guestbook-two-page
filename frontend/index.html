<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Guest Book</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <header class="bar">
      <h1>Guest Messages</h1>
      <a class="button" href="add.html">Add a Message</a>
    </header>

    <input id="q" placeholder="Search by name or text..." class="input" />
    <ul id="messages" class="list"></ul>

    <script>
      let cache = [];

      function render(list) {
        document.getElementById('messages').innerHTML = list.map(m => `
          <li class="item">
            <b>${m.name}</b>: ${m.message}
            <button data-id="${m.id}" class="del">Delete</button>
            <a class="edit" href="add.html?id=${m.id}">Edit</a>
          </li>
        `).join('');
        document.querySelectorAll('.del').forEach(btn => {
          btn.onclick = async () => {
            await fetch('/api/messages/' + btn.dataset.id, { method: 'DELETE' });
            load();
          };
        });
      }

      async function load() {
        const r = await fetch('/api/messages');
        cache = await r.json();
        render(cache);
      }

      document.getElementById('q').addEventListener('input', (e) => {
        const t = e.target.value.toLowerCase();
        const filtered = cache.filter(m =>
          (m.name || '').toLowerCase().includes(t) ||
          (m.message || '').toLowerCase().includes(t)
        );
        render(filtered);
      });

      load();
    </script>
  </body>
</html>
